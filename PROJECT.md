# 專案概覽

## 🎯 專案目標

xml-xlsx-lite 是一個輕量級的 Excel XLSX 檔案生成器，目標是：

1. **提供簡單易用的 API**：參考 exceljs 的設計，讓開發者容易上手
2. **保持輕量級**：只包含核心功能，避免不必要的依賴
3. **支援多平台**：同時支援 Node.js 和瀏覽器環境
4. **漸進式擴展**：從基本功能開始，逐步添加進階特性

## 🏗️ 架構設計

### 核心類別

```
Workbook (工作簿)
├── Worksheet (工作表)
│   └── Cell (儲存格)
└── SharedStrings (共享字串)
```

### 資料流程

1. **建立階段**：使用者建立 Workbook 和 Worksheet，設定儲存格值
2. **收集階段**：系統收集所有儲存格資料和共享字串
3. **生成階段**：將資料轉換為 Office Open XML 格式
4. **打包階段**：使用 JSZip 將 XML 檔案打包成 .xlsx

### 檔案結構

```
dist/
├── index.js          # CommonJS 格式
├── index.esm.js      # ES Module 格式
└── index.d.ts        # TypeScript 型別定義

src/
├── index.ts          # 主要程式碼
└── types.ts          # 型別定義（未來可能分離）

test/
├── test.js           # Node.js 測試
├── test-browser.js   # 瀏覽器測試生成器
└── browser/          # 瀏覽器測試檔案
```

## 🔧 技術選擇

### 核心依賴

- **JSZip**: 處理 ZIP 檔案格式
- **TypeScript**: 提供型別安全和開發體驗
- **tsup**: 快速打包工具，支援多格式輸出

### 為什麼選擇這些技術？

1. **JSZip**: 成熟穩定，支援多平台，API 簡單
2. **TypeScript**: 提供完整的型別定義，提升開發體驗
3. **tsup**: 基於 esbuild，建置速度快，配置簡單

## 📊 功能對比

| 功能 | xml-xlsx-lite | exceljs | xlsx |
|------|---------------|---------|------|
| 檔案大小 | ~50KB | ~2MB | ~1MB |
| 依賴數量 | 1 | 多個 | 多個 |
| API 複雜度 | 簡單 | 中等 | 中等 |
| 功能完整性 | 基礎 | 完整 | 完整 |
| 學習曲線 | 平緩 | 中等 | 中等 |

## 🚀 開發路線圖

### Phase 1: 基礎功能 ✅

- [x] 基本儲存格操作
- [x] 多工作表支援
- [x] 多種資料型別
- [x] Shared Strings 支援
- [x] 基本樣式結構

### Phase 2: 樣式支援 ✅

- [x] 字體設定（粗體、斜體、大小、顏色、底線、刪除線）
- [x] 對齊設定（水平、垂直、換行、縮排、旋轉）
- [x] 填滿設定（背景色、圖案、前景色）
- [x] 邊框設定（樣式、顏色、各邊獨立設定）

### Phase 3: 進階功能 ✅

- [x] 合併儲存格（支援範圍驗證、重疊檢查）
- [x] 欄寬/列高設定（自訂寬度和高度）
- [x] 凍結窗格（支援行列凍結）
- [x] 表格支援（基本結構）
- [x] 公式支援（完整實現）

### Phase 4: 效能優化 ✅

- [x] 記憶體使用優化（大型檔案處理、記憶體洩漏防護）
- [x] 大型檔案處理（分塊處理、虛擬化儲存格）
- [x] 串流處理支援（串流寫入、分塊處理）
- [x] 快取機制（樣式快取、字串快取、智慧快取管理）

### Phase 5: Pivot Table 支援 ✅

- [x] 核心 Pivot Table 功能（資料來源管理、欄位配置）
- [x] 彙總函數支援（SUM, COUNT, AVERAGE, MAX, MIN, STDDEV, VAR）
- [x] 進階功能（計算欄位、篩選條件、樣式設定）
- [x] 欄位管理（添加、移除、重新排序、篩選）
- [x] 資料匯出和更新機制

### Phase 6: 程式碼重構和進階功能 ✅

- [x] 程式碼重構（將 src/index.ts 拆分為多個模組化檔案）
- [x] 工作表保護（密碼保護、操作權限控制）
- [x] 工作簿保護（結構保護、視窗保護）
- [x] 圖表支援（柱狀圖、折線圖、圓餅圖、長條圖、面積圖、散佈圖、環形圖、雷達圖）
- [x] 圖表工廠類別（ChartFactory）
- [x] 圖表選項和樣式設定
- [x] 圖表位置和大小調整
- [x] 圖表資料系列管理

## 🧪 測試策略

### 測試類型

1. **單元測試**: 測試個別函數和類別
2. **整合測試**: 測試完整的工作流程
3. **瀏覽器測試**: 確保瀏覽器環境相容性
4. **效能測試**: 測試大型檔案的處理能力

### 測試覆蓋

- [x] 基本功能測試
- [x] 錯誤處理測試
- [x] 邊界情況測試
- [ ] 效能測試
- [ ] 記憶體洩漏測試

## 🔒 安全性考量

### 輸入驗證

- 儲存格位址格式驗證
- XML 注入防護
- 檔案大小限制

### 依賴安全

- 定期更新依賴
- 使用 npm audit 檢查漏洞
- 最小化依賴數量

## 📈 效能考量

### 記憶體使用

- 使用 Map 和 Set 優化查詢
- 避免不必要的物件建立
- 及時釋放大型資料結構

### 處理速度

- 優化 XML 字串拼接
- 減少重複計算
- 使用適當的資料結構

## 🌐 瀏覽器相容性

### 支援的瀏覽器

- Chrome 60+
- Firefox 55+
- Safari 12+
- Edge 79+

### 功能檢測

- ES6+ 功能支援
- ArrayBuffer 支援
- Blob 支援

## 📱 行動裝置支援

- 觸控操作支援
- 響應式設計
- 效能優化

## 🔮 未來展望

### 短期目標 (3-6 個月)

- 完善樣式支援
- 提升測試覆蓋率
- 優化文件和使用範例

### 中期目標 (6-12 個月)

- 添加公式支援
- 實現合併儲存格
- 建立社群和貢獻者

### 長期目標 (1 年以上)

- 成為輕量級 XLSX 處理的標準選擇
- 建立豐富的生態系統
- 支援更多檔案格式

## 🤝 貢獻指南

### 如何貢獻

1. Fork 專案
2. 建立功能分支
3. 提交變更
4. 建立 Pull Request

### 貢獻領域

- 功能開發
- 錯誤修復
- 文件改進
- 測試增強
- 效能優化

### 開發環境設定

```bash
git clone https://github.com/mikemikex1/xml-xlsx-lite.git
cd xml-xlsx-lite
npm install
npm run dev
```

## 📞 聯絡資訊

- **專案維護者**: Mike
- **GitHub**: mikemikex1
- **Email**: mike1688s@gmail.com
- **Issues**: [GitHub Issues 頁面](https://github.com/mikemikex1/xml-xlsx-lite/issues)

---

**xml-xlsx-lite 致力於為 JavaScript 社群提供簡單、高效、可靠的 Excel 檔案處理解決方案。**
